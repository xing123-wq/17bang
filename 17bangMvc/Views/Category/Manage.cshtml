@model ViewModel.Category.ManageModel
@{
    Layout = "~/Views/Shared/Layout/_DualColumn.cshtml";
}
@section Description
{
    <title>@ViewData["title"]</title>
}<div class="row" style="padding-top: 20px;">
    <div class="col-md-9">
        <h2 class="page-header">
            <span class="fa fa-list" aria-hidden="true"></span> 文章系列管理
            <a class="small pull-right" zyf-category-add><span class="fa fa-plus"></span> 添加</a>
        </h2>
        <div id="app">
            {{ message }}
        </div>

        @foreach (var item in Model._Items)
        {
            @Html.Partial("_List", item)
        }

    </div>

</div>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            message: 'Hello Vue!'
        }
    })
</script>
<div zyf-category-modal class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 zyf-category-header-title class="modal-title">
                    <span class="fa fa-clock-o"></span>
                </h4>
            </div>
            <div zyf-category-modal-body class="modal-body">
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('[zyf-category-add]').click(function (event) {
            var $modal = $('[zyf-category-modal]');
            $modal.find('[zyf-category-header-title]').text('添加新系列');
            $modal.modal('show');
            $.ajax({
                url: '/Category/_New',
                method: 'Get',
                success: function (data) {
                    var $data = $(data);
                    $modal.find('[zyf-category-modal-body]').html($data);
                    postnew($data);
                }
            });
        });
        function postnew(data) {
            var $data = $(data);
            $data.find('[zyf-new-category-submit]').click(function (event) {
                var $form = $(this).parents("form"),
                    $modal = $('[zyf-category-modal]'),
                    formData = $form.serialize();
                $.validator.unobtrusive.parse($data);
                if (!$form.valid()) {
                    return false;
                }
                $.ajax({
                    url: '/Category/_New',
                    method: 'Post',
                    data: formData,
                    success: function (data) {
                        $modal.modal("hide");
                        location.href = '/Category/Manage';
                    }
                });
            });
        }

        $('[zyf-category-delete]').click(function () {
            var Id = $(this).data('self-id');
            $.ajax({
                url: '/Category/_Delete/' + Id,
                method: 'Post',
                success: function () {
                    location.href = '/Category/Manage';
                }
            });
        });



        $('[zyf-category-edit]').click(function (event) {
            event.preventDefault();
            var $modal = $('[zyf-category-modal]'),
                Id = $(this).data('self-id');
            $modal.modal('show');
            $modal.find('[zyf-category-header-title]').text('修改系列');
            $.ajax({
                url: '/Category/_New/' + Id,
                method: 'Get',
                success: function (data) {
                    var $data = $(data),
                        $form = $data.select("form")
                        ;
                    $modal.find('[zyf-category-modal-body]').html($data);
                    $data.find('[zyf-new-category-submit]').click(function (event) {
                        event.preventDefault();
                        if (!$form.valid()) {
                            return false;
                        }
                        $.ajax({
                            url: '/Category/_Eidt?Id=' + Id,
                            method: 'Post',
                            data: $form.serialize(),
                            success: function () {
                                $modal.modal("hide");
                                location.href = '/Category/Manage';
                            }
                        });
                    })
                }
            });

        });
    });
</script>