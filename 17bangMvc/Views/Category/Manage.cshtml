@model ViewModel.Category.ManageModel
@{
    Layout = "~/Views/Shared/Layout/_DualColumn.cshtml";
}
@section Description
{
    <title>@ViewData["title"]</title>
}
<div class="row" style="padding-top: 20px;">
    <div class="col-md-9">
        <h2 class="page-header">
            <span class="fa fa-list" aria-hidden="true"></span> 文章系列管理
            <a class="small pull-right" zyf-category-add><span class="fa fa-plus"></span> 添加</a>
        </h2>
        <div zyf-category-manage-item="" data-parent="0" style="margin-bottom:10px;">
            <span class="pull-right">
                <a zyf-category-edit="" data-self-id="10" style="margin-left: 14px;"><span class="fa fa-edit"></span>编辑</a>
            </span>
            <h4 zyf-category-edit-name="">
                <a class="text-muted" href="/Article/Category-10"><span class="fa fa-folder"></span> 默认分类</a>
            </h4>
            <p zyf-category-edit-description="">
                系统自动生成的默认分类
            </p>
        </div>
        @Html.Action("_List")
    </div>

</div>

<div zyf-category-modal class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 zyf-category-header-title class="modal-title">
                    <span class="fa fa-clock-o"></span>
                </h4>
            </div>
            <div zyf-category-modal-body class="modal-body">
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('[zyf-category-add]').click(function (event) {
            event.preventDefault();
            var $modal = $('[zyf-category-modal]');
            $modal.find('[zyf-category-header-title]').text('添加新系列');
            $modal.modal('show');
            $.ajax({
                url: '/Category/_New',
                method: 'Get',
                success: function (data) {
                    var $data = $(data);
                    $modal.find('[zyf-category-modal-body]').html($data);
                    postnew($data);
                }
            });
        });
        function postnew(data) {
            var $data = $(data);
            $data.find('[zyf-new-category-submit]').click(function (event) {
                event.preventDefault();
                var $form = $(this).parents("form"),
                    $modal = $('[zyf-category-modal]'),
                    formData = $form.serialize();
                $.validator.unobtrusive.parse($data);
                if (!$form.valid()) {
                    return false;
                }
                $.ajax({
                    url: '/Category/_New',
                    method: 'Post',
                    data: formData,
                    success: function () {
                        $modal.modal("hide");
                    }
                });
            });
        }

        $('[zyf-category-cancel]').click(function (event) {
            event.preventDefault();
            var $categoryform = $('[zyf-category-form]');
            $categoryform.addClass("hidden")
        });

        $('[zyf-category-edit]').click(function (event) {
            event.preventDefault();
            var $modal = $('[zyf-category-modal]'),
                $this = $(this),
                $form = $this.parents('form'),
                Id = $this.data('self-id');
            $modal.modal('show');
            $modal.find('[zyf-category-header-title]').text('修改系列');
            $.ajax({
                url: '/Category/_New/' + Id,
                method: 'Get',
                success: function (data) {
                    var $data = $(data);
                    $modal.find('[zyf-category-modal-body]').html($data);
                    $data.find('[zyf-new-category-submit]').click(function (event) {
                        event.preventDefault();
                        if (!$form.valid()) {
                            return false;
                        }
                        $.ajax({
                            url: '/Category/_Eidt/' + Id,
                            method: 'Post',


                        });
                    })
                }
            });

        });
    });
</script>